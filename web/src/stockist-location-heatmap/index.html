<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Daline Nails Repair & Growth Influence</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <style>
      #map {
        height: 100%;
      }

      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }


      /*
        1. Remove shadow border for Samsung devices
        2. Remove default border width and style for Chrome on Windows
        4. Similar styles like standard Google Maps controls
        5. Remove default style that Google Maps apply to buttons
      */
      .control-button {
        position: relative;
        display: block;
        cursor: pointer;
        border-radius: 2px;
        -webkit-appearance: none;
        font-size: 1em;
        background-color: #FFF; /* 1 */
        border-width: 0px; /* 2 */
        border-style: solid; /* 2 */
        margin-right: 10px; /* 4 */
        height: 40px; /* 4 */
        width: 40px; /* 4 */
        box-shadow: rgba(0, 0, 0, 0.3) 0px 1px 4px -1px; /* 4 */
        padding-right: 0; /* 5 */
        padding-left: 0; /* 5 */
      }

      .spin .content {
        display: block;
      }
    </style>
  </head>
  <body>
    <div
      id="map"
      data-zoom="{{ initialPosition.zoom }}"
      data-lat="{{ initialPosition.lat }}"
      data-lng="{{ initialPosition.lng }}",
      data-stores="{{ stores }}"
    ></div>
    <script>
      const q = document.querySelector.bind(document);
      const stores = JSON.parse(q('#map').dataset.stores);

      (function(isBrowserSupported) {
        if (!isBrowserSupported) return;

        // https://lottiefiles.com/26925-gps-satellite
        const locationSearchingBtnImgTag = '<img src="/static/location-searching.gif">';
        const locationButtonImgTag = '<img style="width: 18px; height: 18px; display: block; margin: auto auto;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAMAAABhEH5lAAAAYFBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD6T+iNAAAAH3RSTlMAoejf7RMI9dSRioM5MR3j2sWXfV1WUklEPS0nFg4NKL1nwAAAAIlJREFUGNOV0EcOwzAMRFGJVG/uvfD+t4wdK/AiQAL/5duQGPYjzv/S3hgi0+y3LKjrtq01Lh/Z0CQWI0sGt0xep7kkKuekfSa0CukIlcV8irpA70JHnF/UTxdN/UlnhVNwCihXsCsnZIBDghQuk4RKqnFUsgLJchGEHwYvIN7vr1YQCbs+WeK7F+aSCJM6Mfd2AAAAAElFTkSuQmCC">';

        const createGeolocationButton = (map) => {
          const locationButton = document.createElement('button');
          locationButton.innerHTML = `<span class="content">${locationButtonImgTag}</span>`;
          locationButton.classList.add('control-button');
          return locationButton;
        };

        const Balloon = (map) => {
          const infoWindow = new google.maps.InfoWindow();
          const circle = new google.maps.Circle({
            strokeColor: "rgb(79, 171, 225)",
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: "rgb(163, 226, 251)",
            fillOpacity: 0.35,
            map,
          });

          const thisBalloon = {
            open: (position) => {
              infoWindow.setPosition({
                lat: position.coords.latitude,
                lng: position.coords.longitude,
              });
              infoWindow.open(map);

              circle.setCenter({
                lat: position.coords.latitude,
                lng: position.coords.longitude,
              });
              circle.setRadius(position.coords.accuracy);
              circle.setMap(map);
            },
            close: () => {
              infoWindow.close();
              circle.setMap(null);
            }
          };

          infoWindow.setContent(`
            <div style="border-radius: 70px;">
              <p>You are around here!</p>
              ${locationButtonImgTag}
            </<div>
          `);

          google.maps.event.addListener(map, 'click', function(event) {
            thisBalloon.close();
          });
          google.maps.event.addListener(circle, 'click', function(event) {
            thisBalloon.close();
          });

          // Closing the info window removes the circle too
          google.maps.event.addListener(infoWindow, 'closeclick', function(event) {
            thisBalloon.close();
          });

          return thisBalloon;
        };
        Balloon.create = (map, registry) => {
          for (const registeredBalloon of registry) {
            registeredBalloon.close();
          }

          const balloon = Balloon(map);
          registry.push(balloon);

          return balloon;
        };

        const startSpin = (button) => {
          button.classList.add('spin');
          button.querySelector('.content').innerHTML = locationSearchingBtnImgTag;
        };

        const stopSpin = (button) => {
          button.classList.remove('spin');
          button.querySelector('.content').innerHTML = locationButtonImgTag;
        };

        const ballonsRegistry = [];
        window.initMap = () => {
          const INITIAL_MAP_POSITION = {
            zoom: +q('#map').dataset.zoom,
            mapCenter: { lat: +q('#map').dataset.lat, lng: +q('#map').dataset.lng }
          }
          var map = new google.maps.Map(document.getElementById('map'), {
            zoom: INITIAL_MAP_POSITION.zoom,
            center: INITIAL_MAP_POSITION.mapCenter
          });

          if (navigator.geolocation) {
            const geoLocationBtn = createGeolocationButton(map);
            map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(geoLocationBtn);
            geoLocationBtn.addEventListener('click', () => {
              startSpin(geoLocationBtn)
              navigator.geolocation.getCurrentPosition((position) => {

                map.setCenter({
                  lat: position.coords.latitude,
                  lng: position.coords.longitude,
                });

                // Do not zoom out Google Maps location if customer is with a zoom that's closer than before.
                // Allows for the customer to re-check the location they're in without re-zooming the map back higher
                if (map.getZoom() <= 13) {
                  map.setZoom(13);
                }

                // If location is not accurate, tell the customer but still continue showing the inaccurate balloon
                // Sometimes the area is the whole city or region, which is not very useful but helps if customer starts from the whole Australia zoom
                if (position.coords.accuracy > 1000) {
                  alert('Could not find your accurate location. Make sure Wifi is enabled.');
                }

                const balloon = Balloon.create(map, ballonsRegistry);
                balloon.open(position);

                stopSpin(geoLocationBtn);
              }, (e) => {
                alert(`Error trying to get your location: ${e.message}`);
                stopSpin(geoLocationBtn);
              });
            });
          }

          new google.maps.visualization.HeatmapLayer({
            data: stores.map(seller => new google.maps.LatLng(seller.latLng[0], seller.latLng[1])),
            map: map,
            radius: 50
          });

          stores.forEach(seller => {
            const infowindow = new google.maps.InfoWindow({
              content: `
                <h1>${seller.name}</h1>
                <p><a target="_parent" href="${seller.addressLink}">${seller.address}</a></p>
              `,
              maxWidth: 400,
            });
            const image = {
              url: "data:image/png;base64,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",
              // This marker is 20 pixels wide by 32 pixels high.
              size: new google.maps.Size(50, 69),
              // The origin for this image is (0, 0).
              origin: new google.maps.Point(0, 0)
            };
            const marker = new google.maps.Marker({
              position: { lat: seller.latLng[0], lng: seller.latLng[1] },
              map,
              icon: image,
              title: seller.name,
            });
            marker.addListener('click', () => {
              infowindow.open({
                anchor: marker,
                map,
              });
            });
            google.maps.event.addListener(map, 'click', function(event) {
              infowindow.close();
            });
          })
        }

        const getMapsKey = () => {
          try {
            // Localhost key
            const key = location.href.split('key=')[1].split('&')[0].split('#')[0];
            console.log('Using key:', key);
            return key;
          } catch(e) {
            // Prod key
            console.log('Using PROD key');
            return 'AIzaSyDj5kXqfpKiF34pmONGXZqaD89mj15QQ90';
          }
        };

        document.write(`<script async defer src="https://maps.googleapis.com/maps/api/js?key=${getMapsKey()}&libraries=visualization&callback=initMap"><\/script>`);
      }(function() {
        function supportsArrow() {
          try {
            eval('()=>{}');
          } catch (e) {
            return false;
          }
          return true;
        }
        function supportsAsync() {
          try {
            eval('async () => {}');
            return true;
          } catch (e) { return false }
        }
        function supportsTemplateLiterals() {
          try { return eval("''===``") }
          catch(e) { return false; }
        }
        function supportsClassList() {
          return !!document.documentElement.classList;
        }

        return (
          !!supportsArrow() &&
          !!supportsAsync() &&
          !!supportsTemplateLiterals() &&
          !!supportsClassList()
        );
      }));
    </script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6E8MJKX2N7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6E8MJKX2N7');
    </script>
    <!-- Hotjar Tracking Code for Stockists Map -->
    <script>
        (function(h,o,t,j,a,r){
            h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
            h._hjSettings={hjid:3406262,hjsv:6};
            a=o.getElementsByTagName('head')[0];
            r=o.createElement('script');r.async=1;
            r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
            a.appendChild(r);
        })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
    </script>
  </body>
</html>
